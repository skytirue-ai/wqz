import{Bt as S,It as b,Jt as w,Kt as $,Lt as I,O as C,Rt as E,Ut as D,Vt as G,Wt as m,_t as T,bt as R,ct as H,dt as O,et as A,ft as U,gt as B,ot as v,pt as y,qt as F,rt as q,st as j,ut as M,vt as L,zt as k}from"./vendor-D3kdOx1s.js";function _(e){const{abi:a,data:n}=e,s=L(n,0,4),t=a.find(o=>o.type==="function"&&s===O(F(o)));if(!t)throw new G(s,{docsPath:"/docs/contract/decodeFunctionData"});return{functionName:t.name,args:"inputs"in t&&t.inputs&&t.inputs.length>0?U(t.inputs,L(n,4)):void 0}}var p="/docs/contract/encodeErrorResult";function x(e){const{abi:a,errorName:n,args:s}=e;let t=a[0];if(n){const d=M({abi:a,args:s,name:n});if(!d)throw new E(n,{docsPath:p});t=d}if(t.type!=="error")throw new E(void 0,{docsPath:p});const o=F(t),r=O(o);let c="0x";if(s&&s.length>0){if(!t.inputs)throw new I(t.name,{docsPath:p});c=y(t.inputs,s)}return T([r,c])}var h="/docs/contract/encodeFunctionResult";function J(e){const{abi:a,functionName:n,result:s}=e;let t=a[0];if(n){const r=M({abi:a,name:n});if(!r)throw new k(n,{docsPath:h});t=r}if(t.type!=="function")throw new k(void 0,{docsPath:h});if(!t.outputs)throw new S(t.name,{docsPath:h});const o=(()=>{if(t.outputs.length===0)return[];if(t.outputs.length===1)return[s];if(Array.isArray(s))return s;throw new D(s)})();return y(t.outputs,o)}async function N(e){const{data:a,ccipRequest:n}=e,{args:[s]}=_({abi:w,data:a}),t=[],o=[];return await Promise.all(s.map(async(r,c)=>{try{o[c]=r.urls.includes("x-batch-gateway:true")?await N({data:r.data,ccipRequest:n}):await n(r),t[c]=!1}catch(d){t[c]=!0,o[c]=W(d)}})),J({abi:w,functionName:"query",result:[t,o]})}function W(e){return e.name==="HttpRequestError"&&e.status?x({abi:w,errorName:"HttpError",args:[e.status,e.shortMessage]}):x({abi:[H],errorName:"Error",args:["shortMessage"in e?e.shortMessage:e.message]})}function z(e,a){if(!R(e,{strict:!1}))throw new b({address:e});if(!R(a,{strict:!1}))throw new b({address:a});return e.toLowerCase()===a.toLowerCase()}var K=class extends m{constructor({callbackSelector:e,cause:a,data:n,extraData:s,sender:t,urls:o}){var r;super(a.shortMessage||"An error occurred while fetching for an offchain result.",{cause:a,metaMessages:[...a.metaMessages||[],(r=a.metaMessages)!=null&&r.length?"":[],"Offchain Gateway Call:",o&&["  Gateway URL(s):",...o.map(c=>"    ".concat(q(c)))],"  Sender: ".concat(t),"  Data: ".concat(n),"  Callback selector: ".concat(e),"  Extra data: ".concat(s)].flat(),name:"OffchainLookupError"})}},V=class extends m{constructor({result:e,url:a}){super("Offchain gateway response is malformed. Response data must be a hex value.",{metaMessages:["Gateway URL: ".concat(q(a)),"Response: ".concat(v(e))],name:"OffchainLookupResponseMalformedError"})}},Q=class extends m{constructor({sender:e,to:a}){super("Reverted sender address does not match target contract address (`to`).",{metaMessages:["Contract address: ".concat(a),"OffchainLookup sender address: ".concat(e)],name:"OffchainLookupSenderMismatchError"})}};const tt="0x556f1830",X={name:"OffchainLookup",type:"error",inputs:[{name:"sender",type:"address"},{name:"urls",type:"string[]"},{name:"callData",type:"bytes"},{name:"callbackFunction",type:"bytes4"},{name:"extraData",type:"bytes"}]};async function et(e,{blockNumber:a,blockTag:n,data:s,to:t}){const{args:o}=j({data:s,abi:[X]}),[r,c,d,f,u]=o,{ccipRead:i}=e,g=i&&typeof(i==null?void 0:i.request)=="function"?i.request:Y;try{if(!z(t,r))throw new Q({sender:r,to:t});const l=c.includes("x-batch-gateway:true")?await N({data:d,ccipRequest:g}):await g({data:d,sender:r,urls:c}),{data:P}=await C(e,{blockNumber:a,blockTag:n,data:B([f,y([{type:"bytes"},{type:"bytes"}],[l,u])]),to:t});return P}catch(l){throw new K({callbackSelector:f,cause:l,data:s,extraData:u,sender:r,urls:c})}}async function Y({data:e,sender:a,urls:n}){var t;let s=new Error("An unknown error occurred.");for(let o=0;o<n.length;o++){const r=n[o],c=r.includes("{data}")?"GET":"POST",d=c==="POST"?{data:e,sender:a}:void 0,f=c==="POST"?{"Content-Type":"application/json"}:{};try{const u=await fetch(r.replace("{sender}",a.toLowerCase()).replace("{data}",e),{body:JSON.stringify(d),headers:f,method:c});let i;if((t=u.headers.get("Content-Type"))!=null&&t.startsWith("application/json")?i=(await u.json()).data:i=await u.text(),!u.ok){s=new A({body:d,details:i!=null&&i.error?v(i.error):u.statusText,headers:u.headers,status:u.status,url:r});continue}if(!$(i)){s=new V({result:i,url:r});continue}return i}catch(u){s=new A({body:d,details:u.message,url:r})}}throw s}export{Y as ccipRequest,et as offchainLookup,X as offchainLookupAbiItem,tt as offchainLookupSignature};
