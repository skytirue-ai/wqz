import{$ as t,A as e,C as a,E as s,F as r,I as n,L as o,O as c,P as i,Q as u,S as d,T as l,at as f,ct as h,et as p,j as w,k as m,lt as y,n as g,nt as b,ot as k,rt as x,tt as R,ut as O,w as P}from"./index-Bnkznz5C.js";var E="/docs/contract/encodeErrorResult";function L(e){const{abi:a,errorName:s,args:n}=e;let o=a[0];if(s){const t=c({abi:a,args:n,name:s});if(!t)throw new p(s,{docsPath:E});o=t}if("error"!==o.type)throw new p(void 0,{docsPath:E});const i=y(o),u=m(i);let d="0x";if(n&&n.length>0){if(!o.inputs)throw new t(o.name,{docsPath:E});d=w(o.inputs,n)}return r([u,d])}var M="/docs/contract/encodeFunctionResult";async function v(t){const{data:a,ccipRequest:r}=t,{args:[o]}=function(t){const{abi:a,data:s}=t,r=n(s,0,4),o=a.find(t=>"function"===t.type&&r===m(y(t)));if(!o)throw new x(r,{docsPath:"/docs/contract/decodeFunctionData"});return{functionName:o.name,args:"inputs"in o&&o.inputs&&o.inputs.length>0?e(o.inputs,n(s,4)):void 0}}({abi:O,data:a}),i=[],u=[];return await Promise.all(o.map(async(t,e)=>{try{u[e]=t.urls.includes("x-batch-gateway:true")?await v({data:t.data,ccipRequest:r}):await r(t),i[e]=!1}catch(n){i[e]=!0,u[e]="HttpRequestError"===(a=n).name&&a.status?L({abi:O,errorName:"HttpError",args:[a.status,a.shortMessage]}):L({abi:[s],errorName:"Error",args:["shortMessage"in a?a.shortMessage:a.message]})}var a})),function(t){const{abi:e,functionName:a,result:s}=t;let r=e[0];if(a){const t=c({abi:e,name:a});if(!t)throw new R(a,{docsPath:M});r=t}if("function"!==r.type)throw new R(void 0,{docsPath:M});if(!r.outputs)throw new b(r.name,{docsPath:M});const n=(()=>{if(0===r.outputs.length)return[];if(1===r.outputs.length)return[s];if(Array.isArray(s))return s;throw new f(s)})();return w(r.outputs,n)}({abi:O,functionName:"query",result:[i,u]})}var T=class extends k{constructor({callbackSelector:t,cause:e,data:s,extraData:r,sender:n,urls:o}){super(e.shortMessage||"An error occurred while fetching for an offchain result.",{cause:e,metaMessages:[...e.metaMessages||[],e.metaMessages?.length?"":[],"Offchain Gateway Call:",o&&["  Gateway URL(s):",...o.map(t=>`    ${a(t)}`)],`  Sender: ${n}`,`  Data: ${s}`,`  Callback selector: ${t}`,`  Extra data: ${r}`].flat(),name:"OffchainLookupError"})}},$=class extends k{constructor({result:t,url:e}){super("Offchain gateway response is malformed. Response data must be a hex value.",{metaMessages:[`Gateway URL: ${a(e)}`,`Response: ${P(t)}`],name:"OffchainLookupResponseMalformedError"})}},C=class extends k{constructor({sender:t,to:e}){super("Reverted sender address does not match target contract address (`to`).",{metaMessages:[`Contract address: ${e}`,`OffchainLookup sender address: ${t}`],name:"OffchainLookupSenderMismatchError"})}};const N="0x556f1830",S={name:"OffchainLookup",type:"error",inputs:[{name:"sender",type:"address"},{name:"urls",type:"string[]"},{name:"callData",type:"bytes"},{name:"callbackFunction",type:"bytes4"},{name:"extraData",type:"bytes"}]};async function q(t,{blockNumber:e,blockTag:a,data:s,to:r}){const{args:n}=l({data:s,abi:[S]}),[c,d,f,h,p]=n,{ccipRead:m}=t,y=m&&"function"==typeof m?.request?m.request:D;try{if(!function(t,e){if(!o(t,{strict:!1}))throw new u({address:t});if(!o(e,{strict:!1}))throw new u({address:e});return t.toLowerCase()===e.toLowerCase()}(r,c))throw new C({sender:c,to:r});const s=d.includes("x-batch-gateway:true")?await v({data:f,ccipRequest:y}):await y({data:f,sender:c,urls:d}),{data:n}=await g(t,{blockNumber:e,blockTag:a,data:i([h,w([{type:"bytes"},{type:"bytes"}],[s,p])]),to:r});return n}catch(b){throw new T({callbackSelector:h,cause:b,data:s,extraData:p,sender:c,urls:d})}}async function D({data:t,sender:e,urls:a}){let s=new Error("An unknown error occurred.");for(let n=0;n<a.length;n++){const o=a[n],c=o.includes("{data}")?"GET":"POST",i="POST"===c?{data:t,sender:e}:void 0,u="POST"===c?{"Content-Type":"application/json"}:{};try{const a=await fetch(o.replace("{sender}",e.toLowerCase()).replace("{data}",t),{body:JSON.stringify(i),headers:u,method:c});let r;if(r=a.headers.get("Content-Type")?.startsWith("application/json")?(await a.json()).data:await a.text(),!a.ok){s=new d({body:i,details:r?.error?P(r.error):a.statusText,headers:a.headers,status:a.status,url:o});continue}if(!h(r)){s=new $({result:r,url:o});continue}return r}catch(r){s=new d({body:i,details:r.message,url:o})}}throw s}export{D as ccipRequest,q as offchainLookup,S as offchainLookupAbiItem,N as offchainLookupSignature};