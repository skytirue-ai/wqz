import{A as l,F as Ae,G as r,I as j,J as i,N as T,V as D,b as we,f as Ce,g as be,h as ke,k as Se,m as ye,s as Ie,u as Re,v as b,w,x as c,y as s}from"./vue-vendor-BlJhVHd7.js";import{a as $,i as q,o as F,r as f,s as M,t as k,u as Te}from"./AICStakeTH-c_8XifjU.js";import{n as De,t as $e}from"./useChainId-ueCEH54K.js";import{E as z}from"./call-C6-0Bldy.js";import"./encodeFunctionData-Gz5btn98.js";import"./utils-DgRhDAqe.js";import"./sha2-LijChgah.js";import{Gt as Fe,t as Me}from"./index--94b6r5k.js";import{t as Ne}from"./Spin-BBUMLA3m.js";var He={class:"container"},Le={class:"title"},Pe={class:"info-card"},Ve={class:"info-item"},Be={class:"label"},Ee={class:"info-item"},Ue={class:"label"},Ge={class:"info-item"},Oe={class:"label"},We={class:"info-item"},je={class:"label"},qe={class:"info-item"},ze={class:"label"},Je={class:"value highlight"},Ye={class:"info-item"},Ke={class:"label"},Qe={class:"value"},Xe={class:"info-item"},Ze={class:"label"},xe={class:"value"},ea={class:"action-item"},aa=["disabled"],sa={key:0},na={key:1,class:"spinner"},ia=["disabled"],ta={key:0},oa={key:1,class:"spinner"},ra={class:"input-section"},la={key:0,class:"error-text"},ca={class:"action-section"},da=["disabled"],ua={key:0},va={key:1,class:"spinner"},ma=["disabled"],ga={key:0},pa={key:1,class:"spinner"},fa=3e4,_a={__name:"index",setup(ha){const{t:o}=Ie(),n=Re(),{address:u,isConnected:g}=De(),d=$e(),J={retry:3,retryDelay:2e3},N=q(d.value,"USDT"),p=q(d.value,"AICStakeTH");console.log("AIC_StakeTH_ADDRESS",p),console.log("chainId",d.value);const C=D(!1),v=D(""),m=D(!1),Y=e=>new f(e||0).div(10**18),S=e=>new f(e).div(10**18).toFixed(4),y=e=>new f(e).times(10**18).toFixed(0),H=b(()=>new f(v.value||0).gt(0)),{data:K,refetch:_}=M({address:N,abi:z,functionName:"allowance",args:[u,p],chainId:d,enabled:!!u&&g}),I=b(()=>Y(K.value)),Q=b(()=>I.value.gte(new f(v.value||0))),X=b(()=>{const e=new f(v.value||0),a=I.value;return e.gt(a)?y(e):y(a)}),{data:h,refetch:R}=M({address:p,abi:k,functionName:"getStakeInfo",args:[u],chainId:d,enabled:!!u&&g,onSuccess(){console.debug("getStakeInfo Success...")}}),{data:L,refetch:P}=M({address:p,abi:k,functionName:"getRewardAmount",args:[u],chainId:d,enabled:!!u&&g}),Z=()=>(console.log("refetchStakeAll"),Promise.all([R(),P()])),{writeContractAsync:x,data:ee}=$(),ae=async()=>{if(!g)return n.warning(o("message.notConnected"));try{m.value=!0;const e=await x({address:N,abi:z,functionName:"approve",args:[p,X.value],chainId:d.value,enabled:!!u&&g});_(),n.info("Approveing ...",e)}catch(e){n.error("Approve Failed : "+(e.shortMessage||e.message))}finally{m.value=!1}},{isSuccess:se,isError:ne,error:V,isLoading:B}=F({hash:ee,onSuccess(){_()}});T([se,ne],([e,a])=>{e?(console.log("Approve  Success"),_()):a&&(W(),console.error("Approve Failed ...",V),n.error("Approve Failed:"+V))});const{writeContractAsync:ie,data:te,isPending:E}=$(),oe=async()=>{if(!g)return n.warning(o("message.notConnected"));if(!H.value)return n.warning(o("message.invalidStakeAmount"));const e=new f(v.value||0);if(I.value.lt(e)){n.warning(o("message.insufficientAllowance"));return}try{m.value=!0;const a=await ie({address:p,abi:k,functionName:"stakeTH",args:[[u.value],[y(v.value)]],chainId:d.value});console.log("result",a),n.info(o("message.stakingInProgress"))}catch(a){n.error("".concat(o("message.stakeFailed"))+(a.shortMessage||a.message))}finally{m.value=!1}},{data:U,isSuccess:re,isError:le,error:A,isLoading:ce}=F({hash:te,onSuccess(){C.value=!1,_()}});T([re,le],([e,a])=>{var t;e?(R(),console.log("✅ Receipt:",U)):a&&(console.error("❌ Claim 失败, 回执:",U),n.error("".concat(o("message.claimFailed"))+((A==null?void 0:A.message)||((t=A==null?void 0:A.data)==null?void 0:t.error)||"Claim failed...")))});const{writeContractAsync:de,data:ue,isPending:G}=$(),ve=async()=>{if(!g){n.warning(o("message.notConnected"));return}if(!h||h.value[0]==0){n.warning(o("message.noReward"));return}try{m.value=!0,n.info(o("message.transactionSending"));const e=await de({address:p,abi:k,functionName:"withdrawReward",args:[],chainId:d.value});console.log("Transaction Hash:",e),n.info(o("message.waitingConfirmation"));const a=await Te(Me,{hash:e,timeout:3e4});console.log("等待结果的响应这里Transaction Receipt:",a)}catch(e){console.error("Claiming Error:",e);const a=me(e,o);n.error(a)}finally{m.value=!1}},me=(e,a)=>{const t=e.shortMessage||e.message||"";return t.includes("user rejected")?a("message.userRejected"):t.includes("insufficient funds")?a("message.insufficientGas"):t.includes("execution reverted")?a("message.contractReverted"):"".concat(a("message.claimFailed"),": ").concat(t)},{data:O,isLoading:ge,isSuccess:pe,isError:fe}=F({hash:ue,timeout:fa,query:J});T([pe,fe],([e,a])=>{var t;e?(n.success(o("message.claimSuccess")),console.log("✅ Receipt:",O),Z()):a&&(console.error("❌ Claim 失败, 回执:",O),n.error("".concat(o("message.claimFailed"))+((a==null?void 0:a.message)||((t=a==null?void 0:a.data)==null?void 0:t.error)||"Claim failed...")))});const _e=async()=>{C.value=!0,v.value="",await _()},W=()=>{C.value=!1};return Se(()=>{R(),P(),_()}),(e,a)=>{const t=Ne;return l(),c("div",He,[s("h2",Le,i(e.$t("mining.aic.title")),1),s("div",Pe,[a[6]||(a[6]=s("div",{class:"info-item"},[s("span",{class:"label"},"Firepower Engine"),s("span",{class:"value highlight"},"-")],-1)),s("div",Ve,[s("span",Be,i(e.$t("mining.aic.pool_balance")),1),a[2]||(a[2]=s("span",{class:"value"},"-",-1))]),s("div",Ee,[s("span",Ue,i(e.$t("mining.aic.total_staked")),1),a[3]||(a[3]=s("span",{class:"value"},"-",-1))]),s("div",Ge,[s("span",Oe,i(e.$t("mining.aic.start_time")),1),a[4]||(a[4]=s("span",{class:"value"},"-",-1))]),s("div",We,[s("span",je,i(e.$t("mining.aic.end_time")),1),a[5]||(a[5]=s("span",{class:"value"},"-",-1))]),a[7]||(a[7]=s("div",{class:"divider"},null,-1)),s("div",qe,[s("span",ze,i(e.$t("mining.aic.my_stake")),1),s("span",Je,i(r(h)?S(r(h)[0]):"-")+" AIC",1)]),s("div",Ye,[s("span",Ke,i(e.$t("mining.aic.pending_rewards")),1),s("span",Qe,i(r(L)?S(r(L)):0)+" AIC",1)]),s("div",Xe,[s("span",Ze,i(e.$t("mining.aic.claimed_rewards")),1),s("span",xe,i(r(h)?S(r(h)[2]):"-")+" AIC",1)]),s("div",ea,[s("button",{class:"gradient-padding gradient-button primary-button",disabled:r(E),onClick:_e},[!r(E)&&!r(ce)?(l(),c("span",sa,i(e.$t("common.stake")),1)):(l(),c("div",na,[w(t)]))],8,aa),s("button",{class:"gradient-padding gradient-button secondary-button",disabled:r(G),onClick:ve},[!r(G)&&!r(ge)?(l(),c("span",ta,i(e.$t("common.claim")),1)):(l(),c("div",oa,[w(t)]))],8,ia)])]),w(Ce,{name:"slide-up"},{default:Ae(()=>[j(s("div",{class:"mining-menu-overlay",onClick:W},[s("div",{class:"mining-menu",onClick:a[1]||(a[1]=be(()=>{},["stop"]))},[s("div",ra,[s("label",null,i(e.$t("mining.aic.input_stake_amount")),1),j(s("input",{"onUpdate:modelValue":a[0]||(a[0]=he=>v.value=he),type:"number",min:"0",placeholder:"0.00",class:"stake-input"},null,512),[[ye,v.value]]),H.value?we("",!0):(l(),c("div",la,i(e.$t("mining.aic.enter_valid_amount")),1))]),s("div",ca,[Q.value?(l(),c("button",{key:1,class:"confirm-btn",disabled:m.value,onClick:oe},[m.value?(l(),c("div",pa,[w(t)])):(l(),c("span",ga,i(e.$t("mining.aic.confirm_stake")),1))],8,ma)):(l(),c("button",{key:0,class:"confirm-btn",disabled:r(B),onClick:ae},[r(B)?(l(),c("div",va,[w(t)])):(l(),c("span",ua,i(e.$t("mining.aic.authorize")),1))],8,da))])])],512),[[ke,C.value]])]),_:1})])}}},Ta=Fe(_a,[["__scopeId","data-v-8c6af0d8"]]);export{Ta as default};
