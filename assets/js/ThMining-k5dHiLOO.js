import{A as B,B as Q,N as X,W as g,k as ee,q as d,s as te,u as ne,v as ae,w as se,x as D,y as i}from"./vue-vendor-CWx2MFcM.js";import{a as oe,c as re,i as F,n as o,o as ie,r as E,s as A,t as S}from"./AICStakeTH-CbuWzNAA.js";import{n as le,t as ue}from"./useChainId-CGyOcAHz.js";import"./call-CgSjOEkC.js";import"./encodeFunctionData-D0XVqVej.js";import"./utils-DgRhDAqe.js";import"./sha2-CNMd0RL8.js";import{F as H,Gt as ce,t as de}from"./index-G6kTHV4L.js";import{t as pe}from"./Spin-Bwmj2Gct.js";var me=[{inputs:[],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"role",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"previousAdminRole",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"newAdminRole",type:"bytes32"}],name:"RoleAdminChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"role",type:"bytes32"},{indexed:!0,internalType:"address",name:"account",type:"address"},{indexed:!0,internalType:"address",name:"sender",type:"address"}],name:"RoleGranted",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"role",type:"bytes32"},{indexed:!0,internalType:"address",name:"account",type:"address"},{indexed:!0,internalType:"address",name:"sender",type:"address"}],name:"RoleRevoked",type:"event"},{inputs:[],name:"DEFAULT_ADMIN_ROLE",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"MANAGER_ROLE",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address[]",name:"accounts",type:"address[]"},{internalType:"uint256[]",name:"amounts",type:"uint256[]"}],name:"addStakeDatas",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes32",name:"role",type:"bytes32"}],name:"getRoleAdmin",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"account",type:"address"}],name:"getStakeData",outputs:[{components:[{internalType:"uint256",name:"amount",type:"uint256"},{internalType:"uint256",name:"stakeTime",type:"uint256"},{internalType:"uint256",name:"claimedAmount",type:"uint256"}],internalType:"struct AIC_StakeTH_Data.StakeData",name:"",type:"tuple"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"role",type:"bytes32"},{internalType:"address",name:"account",type:"address"}],name:"grantRole",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes32",name:"role",type:"bytes32"},{internalType:"address",name:"account",type:"address"}],name:"hasRole",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"role",type:"bytes32"},{internalType:"address",name:"account",type:"address"}],name:"renounceRole",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes32",name:"role",type:"bytes32"},{internalType:"address",name:"account",type:"address"}],name:"revokeRole",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"account",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"},{internalType:"uint256",name:"stakeTime",type:"uint256"},{internalType:"uint256",name:"claimedAmount",type:"uint256"}],name:"setStakeData",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"_totalTHAmount",type:"uint256"}],name:"setTotalTHAmount",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"}],name:"stakeDatas",outputs:[{internalType:"uint256",name:"amount",type:"uint256"},{internalType:"uint256",name:"stakeTime",type:"uint256"},{internalType:"uint256",name:"claimedAmount",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes4",name:"interfaceId",type:"bytes4"}],name:"supportsInterface",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[],name:"totalTHAmount",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"}],ye=class{static toBigNumber(u){return u instanceof E?u:typeof u=="bigint"?new E(u.toString()):new E(u)}static fromWei(u,n=18){const e=typeof u=="bigint"?u.toString():u,t=H(BigInt(e),n);return new E(t)}static formatCompactNumber(u,n=1){const e=this.toBigNumber(u);if(e.isNaN()||!e.isFinite()||e.isZero())return"0";const t=e.abs(),a=e.isNegative();let s;return t.isLessThan(1e3)?s=e.toFixed(n).replace(/\.0+$/,""):t.isLessThan(1e4)?s=e.dividedBy(1e3).toFixed(n).replace(/\.0+$/,"")+"k":t.isLessThan(1e6)?s=e.dividedBy(1e4).toFixed(n).replace(/\.0+$/,"")+"w":t.isLessThan(1e9)?s=e.dividedBy(1e6).toFixed(n).replace(/\.0+$/,"")+"m":t.isLessThan(1e12)?s=e.dividedBy(1e9).toFixed(n).replace(/\.0+$/,"")+"b":s=e.dividedBy(1e12).toFixed(n).replace(/\.0+$/,"")+"t",a?"-".concat(s):s}static formatTokenAmount(u,n=18,e=2){const t=this.fromWei(u,n);return this.formatCompactNumber(t,e)}},f,Fe=(f=class{static calculateTotalRelease(n,e){try{if(!n||!e||new o(n).lte(0)||new o(e).lte(0))return new o(0);const t=new o(n),a=new o(e);if(t.gt(a))return console.warn("个人质押数量不能大于总质押数量"),new o(0);console.log("personalStakeAmount (18位):",t.toString()),console.log("totalStakeAmount (18位):",a.toString());const s=t.dividedBy(a).multipliedBy(this.RELEASE_CONFIG.TOTAL_RELEASE_AMOUNT);return console.log("个人总释放量 (18位):",s.toString()),s}catch(t){return console.error("计算个人总释放量时出错:",t),new o(0)}}static calculateTotalReleaseRaw(n,e){try{const t=this.calculateTotalRelease(n,e);return this.from18Decimals(t).toNumber()}catch(t){return console.error("计算个人总释放量时出错:",t),0}}static calculateUnlockedAmount(n,e,t){try{console.log("personalStakeAmount (18位):",n),console.log("totalStakeAmount (18位):",e);const a=this.calculateTotalRelease(n,e),[s,,T]=t,_=new o(s||0),w=new o(T||0);console.log("总释放量 (18位):",a.toString()),console.log("已解锁金额 (18位):",_.toString()),console.log("已提取金额 (18位):",w.toString());const h=a.minus(_).minus(w),v=h.gte(0)?h:new o(0);return console.log("剩余待解锁金额 (18位):",v.toString()),v}catch(a){return console.error("计算未解锁金额时出错:",a),new o(0)}}static calculateUnlockedAmountRaw(n,e,t=[]){try{const a=this.calculateUnlockedAmount(n,e,t);return this.from18Decimals(a).toNumber()}catch(a){return console.error("计算未解锁金额时出错:",a),0}}static calculateUnlockedAmountFormatted(n,e,t=[]){try{const a=this.calculateUnlockedAmountRaw(n,e,t);return new o(a).toFixed(2)}catch(a){return console.error("计算未解锁金额时出错:",a),"0.00"}}static from18Decimals(n){try{return new o(n).dividedBy(10**this.RELEASE_CONFIG.DECIMALS)}catch(e){return console.error("从18位小数转换时出错:",e),new o(0)}}static to18Decimals(n){try{return new o(n).multipliedBy(10**this.RELEASE_CONFIG.DECIMALS)}catch(e){return console.error("转换18位小数时出错:",e),new o(0)}}static getTotalReleaseAmountRaw(){return this.from18Decimals(this.RELEASE_CONFIG.TOTAL_RELEASE_AMOUNT).toNumber()}static debugValues(n,e){console.log("=== 调试信息 ==="),console.log("总释放量配置 (18位):",this.RELEASE_CONFIG.TOTAL_RELEASE_AMOUNT.toString()),console.log("总释放量配置 (原始):",this.getTotalReleaseAmountRaw()),console.log("personalStakeAmount (18位):",n),console.log("totalStakeAmount (18位):",e);const t=this.calculateTotalRelease(n,e);console.log("个人总释放量 (18位):",t.toString()),console.log("个人总释放量 (原始):",this.calculateTotalReleaseRaw(n,e))}},f.RELEASE_CONFIG={TOTAL_RELEASE_AMOUNT:new o(1e6).multipliedBy(10**18),RELEASE_PERIOD_DAYS:720,DECIMALS:18},f),ge={class:"container ba_container"},Te={class:"dividend-container"},be={class:"ba_conter"},fe={class:"ba_title_conts"},he={class:"ba_conts"},Ae={class:"gradient-padding gradient-button"},Se=["disabled"],_e={key:0},we={key:1,class:"spinner"},ve=3e4,Re={__name:"index",setup(u){const{t:n}=te(),e=ne(),{address:t,isConnected:a}=le(),s=ue(),T=F(s.value,"AICStakeTH"),_=F(s.value,"StakeTHData");console.log("AIC_StakeTH_ADDRESS",T),console.log("chainId",s.value);const w={retry:3,retryDelay:2e3},h=Q(!1),v=(r,c=8)=>{const l=H(BigInt(r),18);return new o(l).toFixed(c)},R=(r,c=8)=>{const l=v(r);return ye.formatCompactNumber(l,c)},{data:b,refetch:O}=A({address:T,abi:S,functionName:"getStakeInfo",args:[t],chainId:s,enabled:!!t&&a,onSuccess(){console.log("Stake Successful...")}}),{data:N,refetch:x}=A({address:_,abi:me,functionName:"getStakeData",args:[t],chainId:s,enabled:!!t&&a,onSuccess(r){console.log("Stake Successful...",r)}}),{data:U,refetch:$}=A({address:T,abi:S,functionName:"AICTotalSupply",args:[],chainId:s,enabled:!!t&&a,onSuccess(){console.log("Stake Successful...")}}),{data:G,refetch:W}=A({address:T,abi:S,functionName:"getTotalTHAmount",args:[],chainId:s,enabled:!!t&&a,onSuccess(){console.log("Stake Successful...")}}),{data:C,refetch:P}=A({address:T,abi:S,functionName:"getRewardAmount",args:[t],chainId:s,enabled:!!t&&a,onSuccess(){console.log("Get RewardAmountData Successful...")}}),k=()=>(console.log("refetchStakeAll"),Promise.all([x(),W(),$(),O(),P()])),M=ae(()=>{try{if(!N.value)return console.log("StakeTHData",N),0;const{amount:r,claimedAmount:c}=N.value,l=new o(r||0),m=new o(G.value||0),y=new o(U.value||0),J=new o(c||0),K=new o(C.value||0);if(y.isZero())return 0;const I=y.dividedBy(m).multipliedBy(l).minus(J).minus(K);return console.log("个人质押总释放:",I.toString()),I.isGreaterThan(0)?I.toNumber():0}catch(r){return console.error("计算未解锁金额时出错:",r),0}}),{writeContractAsync:V,data:q,isPending:L}=oe(),Y=async()=>{var r,c;if(!a)return e.warning(n("message.notConnected"));if(console.log("StakeData",b),b&&b.value[0]==0)return e.warning(n("message.noReward"));try{h.value=!0;const l=await V({address:T,abi:S,functionName:"withdrawReward",args:[],chainId:s.value},{onSuccess:y=>{console.log("Claiming Success ",y)},onError:y=>{console.error("Claiming Error ",y)}});console.log("result",l);const m=await re(de,{confirmations:5,hash:l});console.log("✅ Receipt:",m),m.status==="success"?await k():e.error(((r=m.error)==null?void 0:r.shortMessage)||((c=m.error)==null?void 0:c.message)||"Claim failed...")}catch(l){e.error(l.shortMessage||l.message)}finally{h.value=!1}},{data:p,isLoading:Z,isSuccess:j,isError:z}=ie({hash:q,timeout:ve,query:w});return X([j,z],async([r,c])=>{var l,m,y;r?(await k(),console.log("✅ Receipt:",p)):c&&(console.error("❌ Claim 失败, 回执:",p),e.error(((l=p==null?void 0:p.error)==null?void 0:l.shortMessage)||((m=p.error)==null?void 0:m.message)||((y=p==null?void 0:p.data)==null?void 0:y.error)||"Claim failed..."))}),ee(async()=>{await k()}),(r,c)=>{const l=pe;return B(),D("div",ge,[i("div",Te,[i("h2",null,d(r.$t("mining.th.title")),1),i("div",be,[i("div",fe,[i("span",null,[i("em",null,d(r.$t("mining.th.points")),1),i("i",null,d(g(b)?R(g(b)[0]):"0")+" TH",1)])]),i("div",he,[i("span",null,[i("em",null,d(r.$t("mining.th.pending")),1),i("i",null,d(g(C)?R(g(C)):"0")+" AIC",1)]),i("span",null,[i("em",null,d(r.$t("mining.th.locked")),1),i("i",null,d(M.value?R(M.value):"0")+" AIC",1)]),i("span",null,[i("em",null,d(r.$t("mining.th.claimed")),1),i("i",null,d(g(b)?R(g(b)[2]):"0")+" AIC",1)])]),i("div",Ae,[i("button",{class:"primary-button",disabled:g(L),onClick:Y},[!g(L)&&!g(Z)?(B(),D("span",_e,d(r.$t("mining.th.claim")),1)):(B(),D("div",we,[se(l)]))],8,Se)])])])])}}},He=ce(Re,[["__scopeId","data-v-b243d5f8"]]);export{He as default};
