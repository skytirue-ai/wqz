import{A as l,B as T,F as j,N as D,P as Ae,W as r,b as be,f as Ce,g as ke,h as Se,k as ye,m as Ie,q as n,s as Re,u as Te,v as A,w as b,x as c,y as s}from"./vue-vendor-CWx2MFcM.js";import{a as $,i as q,l as De,o as F,r as f,s as M,t as k}from"./AICStakeTH-Ti0OgMF3.js";import{n as $e,t as Fe}from"./useChainId-CyhqGI7H.js";import{E as z}from"./call-QepkpBeX.js";import"./encodeFunctionData-D7VREZIc.js";import"./utils-DgRhDAqe.js";import"./sha2-a3Xesx3k.js";import{Gt as Me,t as Ne}from"./index-7ej6nX57.js";import{t as He}from"./Spin-3Md33nT0.js";var Be={class:"container"},Ee={class:"title"},Le={class:"info-card"},Pe={class:"info-item"},Ue={class:"label"},Ve={class:"info-item"},We={class:"label"},Ge={class:"info-item"},Oe={class:"label"},je={class:"info-item"},qe={class:"label"},ze={class:"info-item"},Qe={class:"label"},Ye={class:"info-item"},Je={class:"label"},Ke={class:"value highlight"},Xe={class:"info-item"},Ze={class:"label"},xe={class:"value"},ea={class:"info-item"},aa={class:"label"},sa={class:"value"},na={class:"action-item"},ia=["disabled"],ta={key:0},oa={key:1,class:"spinner"},ra=["disabled"],la={key:0},ca={key:1,class:"spinner"},da={class:"input-section"},ua={key:0,class:"error-text"},va={class:"action-section"},ma=["disabled"],ga={key:0},pa={key:1,class:"spinner"},fa=["disabled"],_a={key:0},ha={key:1,class:"spinner"},wa=3e4,Aa={__name:"index",setup(ba){const{t:i}=Re(),t=Te(),{address:u,isConnected:g}=$e(),d=Fe(),Q={retry:3,retryDelay:2e3},Y=A(()=>e=>{switch(e){case"a":return i("mining.aic.FirepowerEngine");case"b":return i("mining.aic.QuantStorm");case"c":return i("mining.aic.BlueWhaleBarrage");default:return"Engine"}}),N=q(d.value,"USDT"),p=q(d.value,"AICStakeTH");console.log("AIC_StakeTH_ADDRESS",p),console.log("chainId",d.value);const C=T(!1),v=T(""),m=T(!1),J=e=>new f(e||0).div(10**18),S=e=>new f(e).div(10**18).toFixed(4),y=e=>new f(e).times(10**18).toFixed(0),H=A(()=>new f(v.value||0).gt(0)),{data:K,refetch:_}=M({address:N,abi:z,functionName:"allowance",args:[u,p],chainId:d,enabled:!!u&&g}),I=A(()=>J(K.value)),X=A(()=>I.value.gte(new f(v.value||0))),Z=A(()=>{const e=new f(v.value||0),a=I.value;return e.gt(a)?y(e):y(a)}),{data:h,refetch:R}=M({address:p,abi:k,functionName:"getStakeInfo",args:[u],chainId:d,enabled:!!u&&g,onSuccess(){console.debug("getStakeInfo Success...")}}),{data:B,refetch:E}=M({address:p,abi:k,functionName:"getRewardAmount",args:[u],chainId:d,enabled:!!u&&g}),x=()=>(console.log("refetchStakeAll"),Promise.all([R(),E()])),{writeContractAsync:ee,data:ae}=$(),se=async()=>{if(!g)return t.warning(i("message.notConnected"));try{m.value=!0;const e=await ee({address:N,abi:z,functionName:"approve",args:[p,Z.value],chainId:d.value,enabled:!!u&&g});_(),t.info("Approveing ...",e)}catch(e){t.error("Approve Failed : "+(e.shortMessage||e.message))}finally{m.value=!1}},{isSuccess:ne,isError:ie,error:L,isLoading:P}=F({hash:ae,onSuccess(){_()}});D([ne,ie],([e,a])=>{e?(console.log("Approve  Success"),_()):a&&(O(),console.error("Approve Failed ...",L),t.error("Approve Failed:"+L))});const{writeContractAsync:te,data:oe,isPending:U}=$(),re=async()=>{if(!g)return t.warning(i("message.notConnected"));if(!H.value)return t.warning(i("message.invalidStakeAmount"));const e=new f(v.value||0);if(I.value.lt(e)){t.warning(i("message.insufficientAllowance"));return}try{m.value=!0;const a=await te({address:p,abi:k,functionName:"stakeTH",args:[[u.value],[y(v.value)]],chainId:d.value});console.log("result",a),t.info(i("message.stakingInProgress"))}catch(a){t.error("".concat(i("message.stakeFailed"))+(a.shortMessage||a.message))}finally{m.value=!1}},{data:V,isSuccess:le,isError:ce,error:w,isLoading:de}=F({hash:oe,onSuccess(){C.value=!1,_()}});D([le,ce],([e,a])=>{var o;e?(R(),console.log("✅ Receipt:",V)):a&&(console.error("❌ Claim 失败, 回执:",V),t.error("".concat(i("message.claimFailed"))+((w==null?void 0:w.message)||((o=w==null?void 0:w.data)==null?void 0:o.error)||"Claim failed...")))});const{writeContractAsync:ue,data:ve,isPending:W}=$(),me=async()=>{if(!g){t.warning(i("message.notConnected"));return}if(!h||h.value[0]==0){t.warning(i("message.noReward"));return}try{m.value=!0,t.info(i("message.transactionSending"));const e=await ue({address:p,abi:k,functionName:"withdrawReward",args:[],chainId:d.value});console.log("Transaction Hash:",e),t.info(i("message.waitingConfirmation"));const a=await De(Ne,{hash:e,timeout:3e4});console.log("等待结果的响应这里Transaction Receipt:",a)}catch(e){console.error("Claiming Error:",e);const a=ge(e,i);t.error(a)}finally{m.value=!1}},ge=(e,a)=>{const o=e.shortMessage||e.message||"";return o.includes("user rejected")?a("message.userRejected"):o.includes("insufficient funds")?a("message.insufficientGas"):o.includes("execution reverted")?a("message.contractReverted"):"".concat(a("message.claimFailed"),": ").concat(o)},{data:G,isLoading:pe,isSuccess:fe,isError:_e}=F({hash:ve,timeout:wa,query:Q});D([fe,_e],([e,a])=>{var o;e?(t.success(i("message.claimSuccess")),console.log("✅ Receipt:",G),x()):a&&(console.error("❌ Claim 失败, 回执:",G),t.error("".concat(i("message.claimFailed"))+((a==null?void 0:a.message)||((o=a==null?void 0:a.data)==null?void 0:o.error)||"Claim failed...")))});const he=async()=>{C.value=!0,v.value="",await _()},O=()=>{C.value=!1};return ye(()=>{R(),E(),_()}),(e,a)=>{const o=He;return l(),c("div",Be,[s("h2",Ee,n(e.$t("mining.aic.title")),1),s("div",Le,[s("div",Pe,[s("span",Ue,n(Y.value(e.a)),1),a[2]||(a[2]=s("span",{class:"value highlight"},"-",-1))]),s("div",Ve,[s("span",We,n(e.$t("mining.aic.pool_balance")),1),a[3]||(a[3]=s("span",{class:"value"},"-",-1))]),s("div",Ge,[s("span",Oe,n(e.$t("mining.aic.total_staked")),1),a[4]||(a[4]=s("span",{class:"value"},"-",-1))]),s("div",je,[s("span",qe,n(e.$t("mining.aic.start_time")),1),a[5]||(a[5]=s("span",{class:"value"},"-",-1))]),s("div",ze,[s("span",Qe,n(e.$t("mining.aic.end_time")),1),a[6]||(a[6]=s("span",{class:"value"},"-",-1))]),a[7]||(a[7]=s("div",{class:"divider"},null,-1)),s("div",Ye,[s("span",Je,n(e.$t("mining.aic.my_stake")),1),s("span",Ke,n(r(h)?S(r(h)[0]):"-")+" AIC",1)]),s("div",Xe,[s("span",Ze,n(e.$t("mining.aic.pending_rewards")),1),s("span",xe,n(r(B)?S(r(B)):0)+" AIC",1)]),s("div",ea,[s("span",aa,n(e.$t("mining.aic.claimed_rewards")),1),s("span",sa,n(r(h)?S(r(h)[2]):"-")+" AIC",1)]),s("div",na,[s("button",{class:"gradient-padding gradient-button primary-button",disabled:r(U),onClick:he},[!r(U)&&!r(de)?(l(),c("span",ta,n(e.$t("common.stake")),1)):(l(),c("div",oa,[b(o)]))],8,ia),s("button",{class:"gradient-padding gradient-button secondary-button",disabled:r(W),onClick:me},[!r(W)&&!r(pe)?(l(),c("span",la,n(e.$t("common.claim")),1)):(l(),c("div",ca,[b(o)]))],8,ra)])]),b(Ce,{name:"slide-up"},{default:Ae(()=>[j(s("div",{class:"mining-menu-overlay",onClick:O},[s("div",{class:"mining-menu",onClick:a[1]||(a[1]=ke(()=>{},["stop"]))},[s("div",da,[s("label",null,n(e.$t("mining.aic.input_stake_amount")),1),j(s("input",{"onUpdate:modelValue":a[0]||(a[0]=we=>v.value=we),type:"number",min:"0",placeholder:"0.00",class:"stake-input"},null,512),[[Ie,v.value]]),H.value?be("",!0):(l(),c("div",ua,n(e.$t("mining.aic.enter_valid_amount")),1))]),s("div",va,[X.value?(l(),c("button",{key:1,class:"confirm-btn",disabled:m.value,onClick:re},[m.value?(l(),c("div",ha,[b(o)])):(l(),c("span",_a,n(e.$t("mining.aic.confirm_stake")),1))],8,fa)):(l(),c("button",{key:0,class:"confirm-btn",disabled:r(P),onClick:se},[r(P)?(l(),c("div",pa,[b(o)])):(l(),c("span",ga,n(e.$t("mining.aic.authorize")),1))],8,ma))])])],512),[[Se,C.value]])]),_:1})])}}},Fa=Me(Aa,[["__scopeId","data-v-5ea624d6"]]);export{Fa as default};
