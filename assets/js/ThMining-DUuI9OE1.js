import{A as y,B as q,N as Y,W as g,k as Z,q as u,s as j,u as z,v as J,w as K,x as I,y as r}from"./vue-vendor-CWx2MFcM.js";import{a as Q,c as X,i as ee,n as l,o as te,r as E,s as C,t as T}from"./AICStakeTH-BoA8Rehn.js";import{n as oe,t as ae}from"./useChainId-B6UVa-MH.js";import"./call-EE66qIyq.js";import"./encodeFunctionData-xHecMC5Y.js";import"./utils-DgRhDAqe.js";import"./sha2-DUt-N5T8.js";import{F as D,Gt as se,t as ne}from"./index-bMzaV43Q.js";import{t as re}from"./Spin-DR0Gnd6b.js";var le=class{static toBigNumber(i){return i instanceof E?i:typeof i=="bigint"?new E(i.toString()):new E(i)}static fromWei(i,t=18){const e=typeof i=="bigint"?i.toString():i,o=D(BigInt(e),t);return new E(o)}static formatCompactNumber(i,t=1){const e=this.toBigNumber(i);if(e.isNaN()||!e.isFinite()||e.isZero())return"0";const o=e.abs(),a=e.isNegative();let s;return o.isLessThan(1e3)?s=e.toFixed(t).replace(/\.0+$/,""):o.isLessThan(1e4)?s=e.dividedBy(1e3).toFixed(t).replace(/\.0+$/,"")+"k":o.isLessThan(1e6)?s=e.dividedBy(1e4).toFixed(t).replace(/\.0+$/,"")+"w":o.isLessThan(1e9)?s=e.dividedBy(1e6).toFixed(t).replace(/\.0+$/,"")+"m":o.isLessThan(1e12)?s=e.dividedBy(1e9).toFixed(t).replace(/\.0+$/,"")+"b":s=e.dividedBy(1e12).toFixed(t).replace(/\.0+$/,"")+"t",a?"-".concat(s):s}static formatTokenAmount(i,t=18,e=2){const o=this.fromWei(i,t);return this.formatCompactNumber(o,e)}},p,ie=(p=class{static calculateTotalRelease(t,e){try{if(!t||!e||new l(t).lte(0)||new l(e).lte(0))return new l(0);const o=new l(t),a=new l(e);if(o.gt(a))return console.warn("个人质押数量不能大于总质押数量"),new l(0);console.log("personalStakeAmount (18位):",o.toString()),console.log("totalStakeAmount (18位):",a.toString());const s=o.dividedBy(a).multipliedBy(this.RELEASE_CONFIG.TOTAL_RELEASE_AMOUNT);return console.log("个人总释放量 (18位):",s.toString()),s}catch(o){return console.error("计算个人总释放量时出错:",o),new l(0)}}static calculateTotalReleaseRaw(t,e){try{const o=this.calculateTotalRelease(t,e);return this.from18Decimals(o).toNumber()}catch(o){return console.error("计算个人总释放量时出错:",o),0}}static calculateUnlockedAmount(t,e,o){try{console.log("personalStakeAmount (18位):",t),console.log("totalStakeAmount (18位):",e);const a=this.calculateTotalRelease(t,e),[s,,h]=o,v=new l(s||0),w=new l(h||0);console.log("总释放量 (18位):",a.toString()),console.log("已解锁金额 (18位):",v.toString()),console.log("已提取金额 (18位):",w.toString());const R=a.minus(v).minus(w),_=R.gte(0)?R:new l(0);return console.log("剩余待解锁金额 (18位):",_.toString()),_}catch(a){return console.error("计算未解锁金额时出错:",a),new l(0)}}static calculateUnlockedAmountRaw(t,e,o=[]){try{const a=this.calculateUnlockedAmount(t,e,o);return this.from18Decimals(a).toNumber()}catch(a){return console.error("计算未解锁金额时出错:",a),0}}static calculateUnlockedAmountFormatted(t,e,o=[]){try{const a=this.calculateUnlockedAmountRaw(t,e,o);return new l(a).toFixed(2)}catch(a){return console.error("计算未解锁金额时出错:",a),"0.00"}}static from18Decimals(t){try{return new l(t).dividedBy(10**this.RELEASE_CONFIG.DECIMALS)}catch(e){return console.error("从18位小数转换时出错:",e),new l(0)}}static to18Decimals(t){try{return new l(t).multipliedBy(10**this.RELEASE_CONFIG.DECIMALS)}catch(e){return console.error("转换18位小数时出错:",e),new l(0)}}static getTotalReleaseAmountRaw(){return this.from18Decimals(this.RELEASE_CONFIG.TOTAL_RELEASE_AMOUNT).toNumber()}static debugValues(t,e){console.log("=== 调试信息 ==="),console.log("总释放量配置 (18位):",this.RELEASE_CONFIG.TOTAL_RELEASE_AMOUNT.toString()),console.log("总释放量配置 (原始):",this.getTotalReleaseAmountRaw()),console.log("personalStakeAmount (18位):",t),console.log("totalStakeAmount (18位):",e);const o=this.calculateTotalRelease(t,e);console.log("个人总释放量 (18位):",o.toString()),console.log("个人总释放量 (原始):",this.calculateTotalReleaseRaw(t,e))}},p.RELEASE_CONFIG={TOTAL_RELEASE_AMOUNT:new l(1e6).multipliedBy(10**18),RELEASE_PERIOD_DAYS:720,DECIMALS:18},p),ce={class:"container ba_container"},ue={class:"dividend-container"},de={class:"ba_conter"},me={class:"ba_title_conts"},ge={class:"ba_conts"},he={class:"gradient-padding gradient-button"},fe=["disabled"],_e={key:0},Ae={key:1,class:"spinner"},Se=3e4,pe={__name:"index",setup(i){const{t}=j(),e=z(),{address:o,isConnected:a}=oe(),s=ae(),h=ee(s.value,"AICStakeTH");console.log("AIC_StakeTH_ADDRESS",h),console.log("chainId",s.value);const v={retry:3,retryDelay:2e3},w=q(!1),R=(n,m=8)=>{const c=D(BigInt(n),18);return new l(c).toFixed(m)},_=(n,m=8)=>{const c=R(n);return le.formatCompactNumber(c,m)},{data:A,refetch:O}=C({address:h,abi:T,functionName:"getStakeInfo",args:[o],chainId:s,enabled:!!o&&a,onSuccess(){console.log("Stake Successful...")}}),{data:N,refetch:U}=C({address:h,abi:T,functionName:"AICTotalSupply",args:[],chainId:s,enabled:!!o&&a,onSuccess(){console.log("Stake Successful...")}}),{data:k,refetch:M}=C({address:h,abi:T,functionName:"getTotalTHAmount",args:[],chainId:s,enabled:!!o&&a,onSuccess(){console.log("Stake Successful...")}}),{data:B,refetch:$}=C({address:h,abi:T,functionName:"getRewardAmount",args:[o],chainId:s,enabled:!!o&&a,onSuccess(){console.log("Get RewardAmountData Successful...")}}),b=()=>(console.log("refetchStakeAll"),Promise.all([M(),U(),O(),$()])),L=J(()=>{try{console.log("TotalTHAmount",k.value);const n=ie.calculateUnlockedAmountFormatted(N.value,k.value,A.value);return console.log("totalRelease",n),n}catch(n){return console.error("计算未解锁金额时出错:",n),0}}),{writeContractAsync:H,data:x,isPending:F}=Q(),G=async()=>{var n,m;if(!a)return e.warning(t("message.notConnected"));if(console.log("StakeData",A),A&&A.value[0]==0)return e.warning(t("message.noReward"));try{w.value=!0;const c=await H({address:h,abi:T,functionName:"withdrawReward",args:[],chainId:s.value},{onSuccess:S=>{console.log("Claiming Success ",S)},onError:S=>{console.error("Claiming Error ",S)}});console.log("result",c);const f=await X(ne,{confirmations:5,hash:c});console.log("✅ Receipt:",f),f.status==="success"?await b():e.error(((n=f.error)==null?void 0:n.shortMessage)||((m=f.error)==null?void 0:m.message)||"Claim failed...")}catch(c){e.error(c.shortMessage||c.message)}finally{w.value=!1}},{data:d,isLoading:W,isSuccess:P,isError:V}=te({hash:x,timeout:Se,query:v});return Y([P,V],async([n,m])=>{var c,f,S;n?(await b(),console.log("✅ Receipt:",d)):m&&(console.error("❌ Claim 失败, 回执:",d),e.error(((c=d==null?void 0:d.error)==null?void 0:c.shortMessage)||((f=d.error)==null?void 0:f.message)||((S=d==null?void 0:d.data)==null?void 0:S.error)||"Claim failed..."))}),Z(async()=>{await b()}),(n,m)=>{const c=re;return y(),I("div",ce,[r("div",ue,[r("h2",null,u(n.$t("mining.th.title")),1),r("div",de,[r("div",me,[r("span",null,[r("em",null,u(n.$t("mining.th.points")),1),r("i",null,u(g(N)?_(g(N)):"0")+" TH",1)])]),r("div",ge,[r("span",null,[r("em",null,u(n.$t("mining.th.pending")),1),r("i",null,u(g(B)?_(g(B)):"0")+" AIC",1)]),r("span",null,[r("em",null,u(n.$t("mining.th.locked")),1),r("i",null,u(L.value?L.value:"0")+" AIC",1)]),r("span",null,[r("em",null,u(n.$t("mining.th.claimed")),1),r("i",null,u(g(A)?_(g(A)[2]):"0")+" AIC",1)])]),r("div",he,[r("button",{class:"primary-button",disabled:g(F),onClick:G},[!g(F)&&!g(W)?(y(),I("span",_e,u(n.$t("mining.th.claim")),1)):(y(),I("div",Ae,[K(c)]))],8,fe)])])])])}}},Ie=se(pe,[["__scopeId","data-v-4cd57694"]]);export{Ie as default};
