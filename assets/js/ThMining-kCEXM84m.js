import{A as S,B as W,G as l,J as u,N as O,P as V,R as q,V as B,k as J,s as Y,u as Z,v as j,w as z,x as y,y as r}from"./vue-vendor-BlJhVHd7.js";import{a as K,c as Q,i as X,l as ee,n as te,o as ae,r as v,s as w,t as C}from"./AICStakeTH-c_8XifjU.js";import{n as se,r as ne,t as re}from"./useChainId-ueCEH54K.js";import"./call-C6-0Bldy.js";import"./encodeFunctionData-Gz5btn98.js";import"./utils-DgRhDAqe.js";import"./sha2-LijChgah.js";import{F,Gt as oe,t as ie}from"./index--94b6r5k.js";import{t as ce}from"./Spin-BBUMLA3m.js";function A(a,s={}){try{return a.getClient(s)}catch(e){return}}function le(a,s){const{onChange:e}=s;return a.subscribe(()=>A(a),e,{equalityFn(t,c){return(t==null?void 0:t.uid)===(c==null?void 0:c.uid)}})}function ue(a={}){const s=j(()=>Q(a)),e=ne(s),t=B(A(e,s.value));V(()=>{t.value=A(e,s.value)});const c=le(e,{onChange(n){var g;((g=t.value)==null?void 0:g.uid)!==(n==null?void 0:n.uid)&&(t.value=n)}});return q(()=>c()),W(t)}var de=class{static toBigNumber(a){return a instanceof v?a:typeof a=="bigint"?new v(a.toString()):new v(a)}static fromWei(a,s=18){const e=typeof a=="bigint"?a.toString():a,t=F(BigInt(e),s);return new v(t)}static formatCompactNumber(a,s=1){const e=this.toBigNumber(a);if(e.isNaN()||!e.isFinite()||e.isZero())return"0";const t=e.abs(),c=e.isNegative();let n;return t.isLessThan(1e3)?n=e.toFixed(s).replace(/\.0+$/,""):t.isLessThan(1e4)?n=e.dividedBy(1e3).toFixed(s).replace(/\.0+$/,"")+"k":t.isLessThan(1e6)?n=e.dividedBy(1e4).toFixed(s).replace(/\.0+$/,"")+"w":t.isLessThan(1e9)?n=e.dividedBy(1e6).toFixed(s).replace(/\.0+$/,"")+"m":t.isLessThan(1e12)?n=e.dividedBy(1e9).toFixed(s).replace(/\.0+$/,"")+"b":n=e.dividedBy(1e12).toFixed(s).replace(/\.0+$/,"")+"t",c?"-".concat(n):n}static formatTokenAmount(a,s=18,e=2){const t=this.fromWei(a,s);return this.formatCompactNumber(t,e)}},me={class:"container ba_container"},ge={class:"dividend-container"},fe={class:"ba_conter"},pe={class:"ba_title_conts"},he={class:"ba_conts"},_e={class:"gradient-padding gradient-button"},ve=["disabled"],Ce={key:0},be={key:1,class:"spinner"},Se=3e4,ye={__name:"index",setup(a){const{t:s}=Y(),e=Z(),{address:t,isConnected:c}=se(),n=re(),g=X(n.value,"AICStakeTH");console.log("AIC_StakeTH_ADDRESS",g),console.log("chainId",n.value);const R={retry:3,retryDelay:2e3},I=B(!1),$=(o,m=8)=>{const i=F(BigInt(o),18);return new te(i).toFixed(m)},_=(o,m=8)=>{const i=$(o);return de.formatCompactNumber(i,m)},{data:f,refetch:E}=w({address:g,abi:C,functionName:"getStakeInfo",args:[t],chainId:n,enabled:!!t&&c,onSuccess(){console.log("Stake Successful...")}}),{data:T,refetch:D}=w({address:g,abi:C,functionName:"AICTotalSupply",args:[],chainId:n,enabled:!!t&&c,onSuccess(){console.log("Stake Successful...")}}),{data:k,refetch:x}=w({address:g,abi:C,functionName:"getRewardAmount",args:[t],chainId:n,enabled:!!t&&c,onSuccess(){console.log("Get RewardAmountData Successful...")}}),b=()=>(console.log("refetchStakeAll"),Promise.all([D(),E(),x()])),{writeContractAsync:L,data:H,isPending:N}=K();ue();const M=async()=>{var o,m;if(!c)return e.warning(s("message.notConnected"));if(console.log("StakeData",f),f&&f.value[0]==0)return e.warning(s("message.noReward"));try{I.value=!0;const i=await L({address:g,abi:C,functionName:"withdrawReward",args:[],chainId:n.value},{onSuccess:h=>{console.log("Claiming Success ",h)},onError:h=>{console.error("Claiming Error ",h)}});console.log("result",i);const p=await ee(ie,{confirmations:5,hash:i});console.log("✅ Receipt:",p),p.status==="success"?await b():e.error(((o=p.error)==null?void 0:o.shortMessage)||((m=p.error)==null?void 0:m.message)||"Claim failed...")}catch(i){e.error(i.shortMessage||i.message)}finally{I.value=!1}},{data:d,isLoading:G,isSuccess:P,isError:U}=ae({hash:H,timeout:Se,query:R});return O([P,U],async([o,m])=>{var i,p,h;o?(await b(),console.log("✅ Receipt:",d)):m&&(console.error("❌ Claim 失败, 回执:",d),e.error(((i=d==null?void 0:d.error)==null?void 0:i.shortMessage)||((p=d.error)==null?void 0:p.message)||((h=d==null?void 0:d.data)==null?void 0:h.error)||"Claim failed..."))}),J(async()=>{await b()}),(o,m)=>{const i=ce;return S(),y("div",me,[r("div",ge,[r("h2",null,u(o.$t("mining.th.title")),1),r("div",fe,[r("div",pe,[r("span",null,[r("em",null,u(o.$t("mining.th.points")),1),r("i",null,u(l(T)?_(l(T)):"0")+" TH",1)])]),r("div",he,[r("span",null,[r("em",null,u(o.$t("mining.th.pending")),1),r("i",null,u(l(k)?_(l(k)):"0")+" AIC",1)]),r("span",null,[r("em",null,u(o.$t("mining.th.locked")),1),r("i",null,u(l(f)?_(l(f)[0]):"0")+" AIC",1)]),r("span",null,[r("em",null,u(o.$t("mining.th.claimed")),1),r("i",null,u(l(f)?_(l(f)[2]):"0")+" AIC",1)])]),r("div",_e,[r("button",{class:"primary-button",disabled:l(N),onClick:M},[!l(N)&&!l(G)?(S(),y("span",Ce,u(o.$t("mining.th.claim")),1)):(S(),y("div",be,[z(i)]))],8,ve)])])])])}}},$e=oe(ye,[["__scopeId","data-v-494b8695"]]);export{$e as default};
